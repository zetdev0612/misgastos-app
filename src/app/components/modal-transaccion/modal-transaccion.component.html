<ion-header>
  <ion-toolbar>
    <ion-title>{{ esEdicion ? 'Editar' : 'Nueva' }} Transacción</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancelar()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="transaccionForm">
    <!-- Descripción -->
    <ion-item lines="full">
      <ion-label position="stacked">Descripción *</ion-label>
      <ion-input
        type="text"
        placeholder="Ej: Almuerzo, Transporte, Salario..."
        formControlName="descripcion"
      ></ion-input>
    </ion-item>
    <ion-text color="danger" *ngIf="transaccionForm.get('descripcion')?.invalid && transaccionForm.get('descripcion')?.touched">
      <small class="error-text">La descripción es requerida (mínimo 3 caracteres)</small>
    </ion-text>

    <!-- Monto -->
    <ion-item lines="full">
      <ion-label position="stacked">Monto *</ion-label>
      <ion-input
        type="number"
        placeholder="0"
        formControlName="monto"
      ></ion-input>
    </ion-item>
    <ion-text color="danger" *ngIf="transaccionForm.get('monto')?.invalid && transaccionForm.get('monto')?.touched">
      <small class="error-text">El monto debe ser mayor a 0</small>
    </ion-text>

    <!-- Tipo -->
    <ion-item lines="full">
      <ion-label position="stacked">Tipo *</ion-label>
      <ion-select 
        formControlName="tipo" 
        interface="popover"
        (ionChange)="onTipoChange($event)"
      >
        <ion-select-option value="gasto">Gasto</ion-select-option>
        <ion-select-option value="ingreso">Ingreso</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Categoría -->
    <ion-item lines="full">
      <ion-label position="stacked">Categoría *</ion-label>
      <ion-select 
        formControlName="categoriaId" 
        interface="popover"
        placeholder="Selecciona una categoría"
      >
        <ion-select-option 
          *ngFor="let categoria of categoriasFiltradas" 
          [value]="categoria.id"
        >
          {{ categoria.nombre }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-text color="danger" *ngIf="transaccionForm.get('categoriaId')?.invalid && transaccionForm.get('categoriaId')?.touched">
      <small class="error-text">Selecciona una categoría</small>
    </ion-text>

    <!-- Fecha -->
    <ion-item lines="full">
      <ion-label position="stacked">Fecha *</ion-label>
      <ion-datetime-button datetime="fecha"></ion-datetime-button>
    </ion-item>

    <ion-modal [keepContentsMounted]="true">
      <ng-template>
        <ion-datetime 
          id="fecha" 
          formControlName="fecha"
          presentation="date"
          [max]="maxDate"
        ></ion-datetime>
      </ng-template>
    </ion-modal>

    <!-- Botones -->
    <div class="buttons-container">
      <ion-button expand="block" fill="outline" (click)="cancelar()">
        Cancelar
      </ion-button>
      <ion-button 
        expand="block" 
        (click)="guardar()"
        [disabled]="transaccionForm.invalid"
      >
        {{ esEdicion ? 'Actualizar' : 'Agregar' }}
      </ion-button>
    </div>
  </form>
</ion-content>